resources:
- name: source-code
  type: git
  source:
    uri: https://github.com/devdays-2016/hello-spring-boot.git
    branch: master

- name: cf-deploy
  type: cf
  source:
    api: https://api.run.pivotal.io
    username: {{cf-username}}
    password: {{cf-password}}
    organization: devdays
    space: development

- name: slack-alert
  type: slack-notification
  source:
    url:  https://hooks.slack.com/services/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

jobs:
- name: build
  serial: true
  plan:
  - get: source-code
    trigger: true
  - task: compile
    config:
      inputs:
        - name: source-code
      platform: linux
      image_resource:
        type: docker-image
        source: {repository: maven}
      run:
        path: source-code/script/test
  - task: binary
    config:
      inputs:
        - name: source-code
      outputs:
        - name: build-resource
      platform: linux
      image_resource:
        type: docker-image
        source: {repository: maven}
      run:
        path: source-code/script/binary
  - put: cf-deploy
    params:
      manifest: build-resource/manifest.yml
  - put: slack-alert
    params:
      text: New Deploy available at http://devdays-hello-spring-boot.cfapps.io/
      channel: "#concourse"
      username: ConcourseCI
      icon_url: ":baggage_claim:"
      silent: true
